<tool id="mzidlib_processing" name="mzIdLib:PostProcessing" version="1.0.0">
<!--update from 0.4.0: introduce macro-->
    <description>Using mzIdentML-Lib to do some post processing including FDR calculation etc.</description>
<!--    <command interpreter="perl">
	show.pl $mods $output
    </command>-->
    <command>
        java -Xms1024m -jar $__root_dir__/../gio_applications/mzidlib/mzidlib-maven.jar 
	#if $main.method=="fdr":
FalseDiscoveryRate $input $output -decoyRegex $main.decoyRegex -decoyValue $main.decoyValue -cvTerm $main.cvTerm -betterScoresAreLower $main.betterScoresAreLower
	#elif $main.method=="threshold":
Threshold $input $output -isPSMThreshold $main.isPSMThreshold -cvAccessionForScoreThreshold $main.cvAccessionForScoreThreshold -threshValue $main.threshValue -betterScoresAreLower $main.betterScoresAreLower -deleteUnderThreshold $main.deleteUnderThreshold	
	#elif $main.method=="proteogroup"
ProteoGrouper $input $output -cvAccForSIIScore $main.cvAccForSIIScore -logTransScore $main.logTransScore -requireSIIsToPassThreshold $main.requireSIIsToPassThreshold -verboseOutput false
	#else
Mzid2Csv $input $output -exportType $main.exportType -verboseOutput false
	#end if
    </command>
    <macros>
	<macro name="macro_fdr">
    	    <param name="decoyRegex" type="select" format="Text">
      		<label>Regular expression indicating decoy peptides</label>
      		<option value="XXX_" selected = "true">MS-GF+ ("XXX_")</option>
	    </param>

    	    <param name="decoyValue" type="integer" format="text" value="1">
      		<label>Decoy ratio value</label>
	    </param>

	    <param name="cvTerm" type="select" format="Text">
      		<label>CV term of score to use for FDR calculation</label>
      		<option value="MS:1002053" selected = "true">MS-GF+ E-Value (MS:1002053)</option>
	    </param>

	    <param name="betterScoresAreLower" type="select" format="text">
      		<label>Are better scores lower?</label>
      		<option value="true" selected = "true">Yes</option>
      		<option value="false">No</option>
    	    </param>
	</macro>
	<macro name="macro_threshold">
	    <param name="isPSMThreshold" type="select" format="text">
		<label>Thresholding Level</label>
      		<option value="true" selected = "true">PSM</option>
      		<option value="false">Protein</option>
	    </param>

	    <param name="cvAccessionForScoreThreshold" type="select" format="Text">
      		<label>Score to use for thresholding</label>
      		<option value="MS:1001874" selected = "true">FDRScore (MS:1001874)</option>
	    </param>

	    <param name="threshValue" type="float" format="text" value="0.01">
      		<label>Treshold value</label>
    	    </param>

	    <param name="betterScoresAreLower" type="select" format="text">
      		<label>Are better scores lower?</label>
      		<option value="true" selected = "true">Yes</option>
		<option value="false">No</option>
	    </param>

	    <param name="deleteUnderThreshold" type="select" format="text">
	   	<label>Delete PSMs under threshold?</label>
      		<option value="true" selected = "true">Yes</option>
      		<option value="false">No</option>
	    </param>
	</macro>
	<macro name="macro_proteogroup">
	    <param name="cvAccForSIIScore" type="select" format="Text">
      		<label>CV term of SII score</label>
      		<option value="MS:1001874" selected = "true">FDRScore (MS:1001874)</option>
	    </param>

	    <param name="logTransScore" type="select" format="text">
      		<label>Log tranform scores</label>
      		<option value="true" selected = "true">Yes</option>
      		<option value="false">No</option>
	    </param>

	    <param name="requireSIIsToPassThreshold" type="select" format="text">
      		<label>Require SIIs to pass threshold</label>
      		<option value="true" selected = "true">Yes</option>
      		<option value="false">No</option>
	    </param>
	</macro>
	<macro name="macro_mzid2csv">
	    <param name="exportType" type="select" format="text">
      		<option value="exportProteinGroups" selected = "true">exportProteinGroups</option>
      		<option value="exportPSMs">exportPSMs</option>
      		<option value="exportProteinsOnly">exportProteinsOnly</option>
      		<option value="exportRepProteinPerPAGOnly">exportRepProteinPerPAGOnly</option>
	    </param>
	</macro>
    </macros>
    <inputs>	
	<param  format="mzid" name="input" type="data" label="Input file"/>
	<conditional name="main">
	    <param name="method" type="select" label="Method: ">
		<option value="fdr">False Discovery Rate</option>
		<option value="threshold">Threshold</option>
		<option value="proteogroup">ProteoGrouper</option>
		<option value="mzid2csv">Export into CSV</option>
	    </param>
	    <when value="fdr">
		<expand macro="macro_fdr"/>
	    </when>
	    <when value="threshold">
		<expand macro="macro_threshold"/>
	    </when>
	    <when value="proteogroup">
		<expand macro="macro_proteogroup"/>
	    </when>
	    <when value="mzid2csv">
		<expand macro="macro_mzid2csv"/>
	    </when>
	</conditional>
    </inputs>

    <outputs>
	<data format="mzid" name="output"/>
    </outputs>

    <help>

**What it does**

Runs an MS/MS database search using the MSGFPlus search engine.

----

**References**

Please see http://proteomics.ucsd.edu/Software/MSGFPlus.html for details of the MSGFPlus search engine and references describing its algorithm

    </help>

</tool>
